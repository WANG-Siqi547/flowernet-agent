# FlowerNet åŒç‹¬ç«‹ç«¯ç‚¹æ¶æ„

## ğŸ¯ ç›®æ ‡

ä¸º FlowerNet ç³»ç»Ÿçš„ä¸¤ä¸ªæ ¸å¿ƒæœåŠ¡åˆ›å»º**ä¸¤ä¸ªç‹¬ç«‹çš„å…¬ç½‘ URL**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å¤–ç½‘è®¿é—®å±‚                                â”‚
â”‚  https://abc-xxx.ngrok-free.dev      https://xyz-yyy.ngrok-free.dev
â”‚  (Controller)                        (Verifier)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ngrok Process 1     â”‚          â”‚   Ngrok Process 2     â”‚
â”‚  (ä¸»æœºä¸Šè¿è¡Œ)          â”‚          â”‚  (ä¸»æœºä¸Šè¿è¡Œ)          â”‚
â”‚  ç«¯å£: 4040           â”‚          â”‚  ç«¯å£: 4040           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                    â†“
    localhost:8001                    localhost:8000
         â†“                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Docker Network: flowernet (127.0.0.1)           â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Controller Service   â”‚      â”‚  Verifier Service    â”‚   â”‚
â”‚  â”‚  (flower-controller)  â”‚      â”‚  (flower-verifier)   â”‚   â”‚
â”‚  â”‚  ç«¯å£: 8001           â”‚      â”‚  ç«¯å£: 8000          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                           â”‚
â”‚  ç¯å¢ƒå˜é‡:                                               â”‚
â”‚  VERIFIER_URL=                                           â”‚
â”‚    http://verifier-app:8000                              â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ ä¸ºä»€ä¹ˆé‡‡ç”¨è¿™ä¸ªæ¶æ„?

### âŒ ä¹‹å‰çš„æ–¹æ³• (Docker å®¹å™¨ä¸­è¿è¡Œ Ngrok)

```yaml
services:
  ngrok-controller:
    image: ngrok/ngrok
    container_name: flower-tunnel-controller
    command: http controller-app:8001
```

**é—®é¢˜:**
- âŒ Docker for Mac çš„ç½‘ç»œéš”ç¦»é™åˆ¶
- âŒ å®¹å™¨æ— æ³•å¯é åœ°è¿æ¥åˆ°å¤–éƒ¨ Ngrok è®¤è¯æœåŠ¡å™¨
- âŒ å¯¼è‡´ `network is unreachable` é”™è¯¯
- âŒ å¤šä¸ªå®¹å™¨ç«äº‰åŒä¸€ä¸ª Ngrok token

### âœ… ç°åœ¨çš„æ–¹æ³• (ä¸»æœºä¸Šè¿è¡Œ Ngrok)

**ä¼˜åŠ¿:**
- âœ… é¿å… Docker ç½‘ç»œé™åˆ¶
- âœ… æ›´ç¨³å®šæ›´å¯é 
- âœ… æ›´æ˜“äºè°ƒè¯•å’Œç›‘æ§
- âœ… å®Œå…¨ç‹¬ç«‹çš„éš§é“å’Œ URL
- âœ… æ›´ç®€æ´çš„è®¾ç½®

## ğŸ“‹ æ¶æ„ç»„ä»¶

### 1. **Docker Layer (å®¹å™¨å†…)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ verifier-app (flower-verifier)           â”‚
â”‚ â”œâ”€ Image: flowernet-verifier:latest     â”‚
â”‚ â”œâ”€ Port: 8000 (exposed to host)         â”‚
â”‚ â”œâ”€ Health: healthy                      â”‚
â”‚ â””â”€ Volumes: verifier_cache              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ controller-app (flower-controller)       â”‚
â”‚ â”œâ”€ Image: flowernet-controller:latest   â”‚
â”‚ â”œâ”€ Port: 8001 (exposed to host)         â”‚
â”‚ â”œâ”€ Depends: verifier-app (healthy)      â”‚
â”‚ â”œâ”€ Environment:                         â”‚
â”‚ â”‚  â””â”€ VERIFIER_URL=...                  â”‚
â”‚ â””â”€ Network: flowernet (bridge)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **Host Layer (ä¸»æœºä¸Š)**

```
Terminal 1                    Terminal 2
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ngrok-controller.sh   â”‚    â”‚ ngrok-verifier.sh     â”‚
â”‚                       â”‚    â”‚                       â”‚
â”‚ Tunnel: 8001          â”‚    â”‚ Tunnel: 8000          â”‚
â”‚ URL: https://abc...   â”‚    â”‚ URL: https://xyz...   â”‚
â”‚ Local: 4040           â”‚    â”‚ Local: 4040           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. **Network Configuration**

```
Flow 1: å¤–éƒ¨è¯·æ±‚ â†’ Controller
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤–éƒ¨å®¢æˆ·ç«¯           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTPS
           â”‚ https://abc-xxx.ngrok-free.dev
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Ngrok å®¢æˆ·ç«¯  â”‚
    â”‚ (ä¸»æœº:4040)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTP
           â”‚ localhost:8001
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Controller Service   â”‚
    â”‚ (Docker: 8001)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Flow 2: å¤–éƒ¨è¯·æ±‚ â†’ Verifier
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤–éƒ¨å®¢æˆ·ç«¯           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTPS
           â”‚ https://xyz-yyy.ngrok-free.dev
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Ngrok å®¢æˆ·ç«¯  â”‚
    â”‚ (ä¸»æœº:4040)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTP
           â”‚ localhost:8000
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Verifier Service     â”‚
    â”‚ (Docker: 8000)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Flow 3: Controller â†’ Verifier (å†…éƒ¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller       â”‚
â”‚ (docker)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ å†…éƒ¨ Docker Network
         â”‚ http://verifier-app:8000
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Verifier         â”‚
    â”‚ (docker)         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å®Œæ•´å¯åŠ¨æµç¨‹

### æ­¥éª¤ 1: å‡†å¤‡ç¯å¢ƒ
```bash
cd /path/to/flowernet-agent

# ä½¿è„šæœ¬å¯æ‰§è¡Œ
chmod +x ngrok-controller.sh
chmod +x ngrok-verifier.sh
chmod +x start-dual-endpoints.sh
```

### æ­¥éª¤ 2: å¯åŠ¨ Docker æœåŠ¡
```bash
docker-compose up -d

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
# éªŒè¯:
# - flower-verifier: healthy âœ“
# - flower-controller: up âœ“
```

### æ­¥éª¤ 3: å¯åŠ¨ Ngrok éš§é“

**é€‰é¡¹ A: è‡ªåŠ¨ (tmux)**
```bash
./start-dual-endpoints.sh
# é€‰æ‹©é€‰é¡¹ 1
```

**é€‰é¡¹ B: æ‰‹åŠ¨ (æ¨èåˆæœŸè°ƒè¯•)**

ç»ˆç«¯ 1:
```bash
./ngrok-controller.sh
# è¾“å‡º: Forwarding https://abc-xxx.ngrok-free.dev -> http://localhost:8001
```

ç»ˆç«¯ 2:
```bash
./ngrok-verifier.sh
# è¾“å‡º: Forwarding https://xyz-yyy.ngrok-free.dev -> http://localhost:8000
```

## ğŸ”— ä½¿ç”¨å…¬ç½‘ URL

### ç›´æ¥è°ƒç”¨ (æ— è®¤è¯)

```bash
# è°ƒç”¨ Controller
curl https://abc-xxx.ngrok-free.dev/process \
  -H "Content-Type: application/json" \
  -d '{"outline": "...", "max_iterations": 3}'

# è°ƒç”¨ Verifier
curl https://xyz-yyy.ngrok-free.dev/verify \
  -H "Content-Type: application/json" \
  -d '{"generated_text": "...", "source_text": "..."}'
```

### åœ¨åº”ç”¨ä¸­é…ç½®

```python
# Python
CONTROLLER_URL = "https://abc-xxx.ngrok-free.dev"
VERIFIER_URL = "https://xyz-yyy.ngrok-free.dev"

import requests
response = requests.post(f"{CONTROLLER_URL}/process", json={...})
```

```javascript
// JavaScript/Node.js
const CONTROLLER_URL = "https://abc-xxx.ngrok-free.dev";
const VERIFIER_URL = "https://xyz-yyy.ngrok-free.dev";

fetch(`${CONTROLLER_URL}/process`, {
  method: 'POST',
  body: JSON.stringify({...})
})
```

```bash
# Bash/Shell
CONTROLLER_URL="https://abc-xxx.ngrok-free.dev"
VERIFIER_URL="https://xyz-yyy.ngrok-free.dev"

curl -X POST "$CONTROLLER_URL/process" -d "{...}"
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### Ngrok Web UI

è®¿é—® Ngrok çš„æœ¬åœ°æ£€æŸ¥ç•Œé¢:

```
Controller: http://localhost:4040
â”œâ”€ æŸ¥çœ‹æ‰€æœ‰è¯·æ±‚
â”œâ”€ è¯·æ±‚/å“åº”æ£€æŸ¥å™¨
â”œâ”€ æ€§èƒ½ç»Ÿè®¡
â””â”€ ç«¯å£è½¬å‘é…ç½®
```

### Docker æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹ Controller æ—¥å¿—
docker-compose logs -f controller-app

# å®æ—¶æŸ¥çœ‹ Verifier æ—¥å¿—
docker-compose logs -f verifier-app

# æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f
```

### æœ¬åœ°å¥åº·æ£€æŸ¥

```bash
# Verifier å¥åº·æ£€æŸ¥
curl http://localhost:8000/

# Controller å¥åº·æ£€æŸ¥
curl http://localhost:8001/
```

## ğŸ”„ URL æ›´æ–°å‘¨æœŸ

### å…è´¹è®¡åˆ’
- âœ… æ¯æ¬¡å¯åŠ¨ä¼šç”Ÿæˆæ–° URL
- â±ï¸ URL æœ‰æ•ˆæœŸ: 24 å°æ—¶
- ğŸ“‹ é€‚åˆ: å¼€å‘å’Œæµ‹è¯•

### ä»˜è´¹è®¡åˆ’ (Ngrok Pro)
- âœ… å¯é¢„ç•™å›ºå®šå­åŸŸå
- âœ… URL æ°¸ä¹…ä¿ç•™
- ğŸ“‹ é€‚åˆ: ç”Ÿäº§ç¯å¢ƒ

## ğŸ›‘ ä¼˜é›…åœæ­¢

```bash
# åœæ­¢ Ngrok (åœ¨æ¯ä¸ªç»ˆç«¯)
# æŒ‰ Ctrl+C

# åœæ­¢ Docker æœåŠ¡
docker-compose down

# å®Œå…¨æ¸…ç† (åŒ…æ‹¬ç¼“å­˜)
docker-compose down -v
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **æ·»åŠ è®¤è¯**
   ```bash
   ngrok http 8001 --auth="user:password"
   ```

2. **é™åˆ¶è®¿é—®**
   ```bash
   # åªå…è®¸ç‰¹å®š IP
   ngrok http 8001 --cidr-allow=203.0.113.0/24
   ```

3. **ç›‘æ§è¯·æ±‚**
   - å®šæœŸæ£€æŸ¥ Ngrok Web UI
   - æ£€æŸ¥ Docker æ—¥å¿—å¼‚å¸¸

4. **å®šæœŸæ›´æ–°**
   ```bash
   ngrok update
   docker-compose pull && docker-compose up -d
   ```

## ğŸ“ˆ æ‰©å±•æ–¹æ¡ˆ

### æ·»åŠ æ›´å¤šæœåŠ¡

å¦‚æœéœ€è¦æ·»åŠ ç¬¬ä¸‰ä¸ªç«¯ç‚¹ (ä¾‹å¦‚æ•°æ®åº“ API):

```bash
# ç»ˆç«¯ 3: æ–°æœåŠ¡éš§é“
ngrok http 8002 --authtoken="..." --region=us
```

### åœ°ç†ä½ç½®ä¼˜åŒ–

æ ¹æ®ç”¨æˆ·ä½ç½®é€‰æ‹©æœ€è¿‘çš„ Ngrok åŒºåŸŸ:

```bash
# äºšæ´²
./ngrok-controller.sh --region=ap

# æ¬§æ´²
./ngrok-controller.sh --region=eu

# åŒ—ç¾
./ngrok-controller.sh --region=us
```

## ğŸ“ æ€»ç»“

| ç‰¹æ€§ | å€¼ |
|------|-----|
| Controller å…¬ç½‘åœ°å€ | https://xxx.ngrok-free.dev |
| Verifier å…¬ç½‘åœ°å€ | https://yyy.ngrok-free.dev |
| æœ¬åœ° Controller | http://localhost:8001 |
| æœ¬åœ° Verifier | http://localhost:8000 |
| Docker Network | bridge (flowernet) |
| è®¤è¯æ–¹å¼ | Ngrok token |
| ç›‘æ§åœ°å€ | http://localhost:4040 |
| æœ€å¤§éš§é“æ•° (å…è´¹) | 4 ä¸ª |

## ğŸ†˜ æ•…éšœæ’æŸ¥å¿«é€Ÿå‚è€ƒ

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose down && docker-compose up -d

# æŸ¥çœ‹æ‰€æœ‰é”™è¯¯
docker-compose logs

# æ¸…ç† Docker ç¼“å­˜
docker system prune -a

# æµ‹è¯•è¿æ¥
curl -v http://localhost:8000/
curl -v http://localhost:8001/

# æŸ¥çœ‹å ç”¨çš„ç«¯å£
lsof -i :8000
lsof -i :8001
lsof -i :4040

# æ€æ­»è¿›ç¨‹
kill -9 <PID>
```

---

**æ›´å¤šä¿¡æ¯:** æŸ¥çœ‹ `QUICK_START_DUAL_ENDPOINTS.md` äº†è§£å¿«é€Ÿå¯åŠ¨æŒ‡å—
